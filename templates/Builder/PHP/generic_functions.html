<?php
/**
* {$componentName}
* generated by WMF-Builder
* @TODO add more methods to these class.
*/
include_once $ENGINE_PATH."Utility/Paginate.php";
include_once $ENGINE_PATH."Utility/Thumbnail.php";
class {$componentName} extends SQLData{literal}{{/literal}
    var $View;
	var $Paging;
	var $Thumb;
	var $Request;
	function {$componentName}($req){literal}{{/literal}
		parent::SQLData();
		$this->View = new BasicView();
		$this->Paging = new Paginate();
		$this->Thumb = new Thumbnail();
		$this->Request = $req;
    {literal}
	}

	
	
	/************** ADMIN FUNCTIONS**************************************/
	function admin(){
		$req = $this->Request;
		if($req->getPost("r")=="add"){
			return $this->PerformAddItem();
		}else if($req->getPost("r")=="update"){
        	return $this->PerformUpdateItem();
        }else if($req->getParam("r")=="delete"){
			return $this->delete($this->Request->getParam("id"));
		}else if($req->getParam("r")=="edit"){
			return $this->EditForm($this->Request->getParam("id"));
		}else if($req->getParam("r")=="new"){
			return $this->NewForm();
		}else{
			return $this->showManagePage();
		}
	}
	/***** BASIC FUNCTIONS ***********************************************/
    {/literal}
{literal}function get($id){{/literal}
	return $this->fetch("SELECT * FROM {$table_name} WHERE id='".$id."' LIMIT 1");
{literal}}{/literal}
{literal}function getAll(){{/literal}
	return $this->fetch("SELECT * FROM {$table_name}",1);
{literal}}{/literal}
{literal}function retrieveByPage($start,$total=30){{/literal}
	return $this->fetch("SELECT * FROM {$table_name} LIMIT ".$start.",".$total,1);
{literal}}{/literal}
function insert({section name=i loop=$visible_fields}{if $smarty.section.i.index eq '0'}${$visible_fields[i]}{else},${$visible_fields[i]}{/if}{/section}){literal}{{/literal}

	return $this->query("INSERT INTO {$table_name}({section name=i loop=$visible_fields}{if $smarty.section.i.index eq '0'}{$visible_fields[i]}{else},{$visible_fields[i]}{/if}{/section}) 
    VALUES({section name=i loop=$visible_fields}{if $smarty.section.i.index eq '0'}'${$visible_fields[i]}'{else},'${$visible_fields[i]}'{/if}{/section})");
{literal}}{/literal}

function update($id,{section name=i loop=$visible_fields}{if $smarty.section.i.index eq '0'}${$visible_fields[i]}{else},${$visible_fields[i]}{/if}{/section}){literal}{{/literal}
	return $this->query("UPDATE {$table_name} SET {section name=i loop=$visible_fields}{if $smarty.section.i.index eq '0'}{$visible_fields[i]}='${$visible_fields[i]}'{else},{$visible_fields[i]}='${$visible_fields[i]}'{/if}{/section} 
    WHERE id='".$id."'");
{literal}}{/literal}

function delete($id){literal}{{/literal}
	return $this->query("DELETE FROM {$table_name} WHERE id='".$id."'");
{literal}}{/literal}

	function performAddItem(){literal}{{/literal}
    {section name=i loop=$visible_fields}
	${$visible_fields[i]} = $this->Request->getPost("{$visible_fields[i]}");
 {/section}
    	if($this->insert({section name=i loop=$visible_fields}{if $smarty.section.i.index eq '0'}${$visible_fields[i]}{else},${$visible_fields[i]}{/if}{/section})){literal}{
        	$msg = "The item has been added successfully !";
        }else{
        	$msg = "Cannot add the item, please try again later !";
        }
        {/literal}
        return $this->View->showMessage($msg,"index.php?s={$componentID}");
   {literal} }{/literal}
	
    function performUpdateItem(){literal}{{/literal}
    $id = $this->Request->getPost("id");
    {section name=i loop=$visible_fields}
	${$visible_fields[i]} = $this->Request->getPost("{$visible_fields[i]}");
 {/section}
    	if($this->update($id,{section name=i loop=$visible_fields}{if $smarty.section.i.index eq '0'}${$visible_fields[i]}{else},${$visible_fields[i]}{/if}{/section})){literal}{
        	$msg = "The item has been updated successfully !";
        }else{
        	$msg = "Cannot update the item, please try again later !";
        }
        {/literal}
        return $this->View->showMessage($msg,"index.php?s={$componentID}");
   {literal} }{/literal}
   {literal}
    function showManagePage(){
    	//WRITE CODE HERE
    }
    {/literal}
    function NewForm(){literal}{{/literal}
    	return $this->View->toString("{$componentName}/admin/new.html");
    {literal}}{/literal}
    
     function EditForm($id){literal}{{/literal}
     	$id = mysql_escape_string($id);
     	$this->View->assign("rs",$this->get($id));
    	return $this->View->toString("{$componentName}/admin/edit.html");
    {literal}}{/literal}
{literal}}{/literal}
?>